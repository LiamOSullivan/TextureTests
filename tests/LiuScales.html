<!DOCTYPE html>
<html>
    <head>
        <script src="js/jquery.min.js"></script>
        <script src="js/jquery-ui.min.js"></script>
        <script src="../jspsych.js"></script>
        <script src="../plugins/slider-button-response.js"></script>
        <script src="../plugins/jspsych-instructions.js"></script>
        <script src="../plugins/jspsych-text.js"></script>
        <link rel="stylesheet" href="../css/jspsych.css">
        <link rel="stylesheet" href="css/jquery-ui.css">
        <link rel="icon" href="data:;base64,iVBORw0KGgo="> 

    </head>
    <body>
        <div id="jspsych-target"></div>

        <script src="https://www.gstatic.com/firebasejs/3.6.4/firebase.js"></script>

        <script>
            var contentsPath = "textures/ansinoise/contents.txt";
            var text = FileHelper.readStringFromFileAtPath(contentsPath);
            console.log(text);
            //loading the contents text file
            function FileHelper() {
                FileHelper.readStringFromFileAtPath = function (pathOfFileToReadFrom)
                {
                    var request = new XMLHttpRequest();
                    request.open("GET", pathOfFileToReadFrom, false);
                    request.send(null);
                    var returnValue = request.responseText;

                    return returnValue;
                }
            }
            
            
//
//            //loading images into the array
//            var imageArray = [];
//
//            function initImageArray() {
//                //Use a better way to load the number of images I need (~2-5),
//                //rather than filling a large array every time the page is loaded?
//                for (var i = 0; i <= nImages; i++) {
//                    var iPath = "textures/ansinoise/" + i + ".bmp";
//
//                    imageArray.push(iPath);
//                }
//                console.log("imageArray has " + imageArray.length + " elements");
//            }

    //            function chooseImages() {
    //                //TODO ensure different pics chosen
    //                var randomNum1 = Math.floor(Math.random() * imageArray.length);
    //                testImage1.src = imageArray[randomNum1];
    //                if (debug) {
    //                    testImage1.title = "Texture #" + randomNum1; //gives image index as rollover
    //                } //for debug
    //                testImage1.onclick = function () {
    //                    imageClickEvent(randomNum1)
    //                };
    //                var randomNum2 = Math.floor(Math.random() * imageArray.length);
    //                while (randomNum2 == randomNum1) {
    //                    randomNum2 = Math.floor(Math.random() * imageArray.length); //ensure both images are never the same
    //                }
    //                testImage2.src = imageArray[randomNum2];
    //                if (debug) {
    //                    testImage2.title = "Texture #" + randomNum2;
    //                }
    //                testImage2.onclick = function () {
    //                    imageClickEvent(randomNum2)
    //                };
    //
    //                console.log("load images " + randomNum1 + " and " + randomNum2);
    //                //pick one of the 2 random numbers to use that sound index
    //                var picked = Math.random() < 0.5 ? randomNum1 : randomNum2;
    //                console.log("picking sound " + picked);
    //                chooseSound(picked);
    //
    //            }

        </script>

        <script>
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyA6aO0Rb19oJ_rojZ4tL0LagYArXpnn9Qc",
                authDomain: "fir-test-15633.firebaseapp.com",
                databaseURL: "https://fir-test-15633.firebaseio.com",
                storageBucket: "fir-test-15633.appspot.com",
                messagingSenderId: "572281505960"
            };
            firebase.initializeApp(config);


            database = firebase.database();
            tests = database.ref('texturetests');
            var timeN = new Date().valueOf(); //timestamp in seconds


            var data = {
                name: 'pageLoad',
                time: timeN
            };
            //fruits.push(data);
            //database.ref('fruits').push(data);
            tests.push(data, pushFinished); //callback

            function pushFinished(error) {
                if (error) {
                    console.log('Error on push to DB');
                } else {
                    console.log('Test data saved to DB');
                }
            }

            var ref = database.ref("texturetests");
            ref.on("value", gotData, errData); //value triggered on changes to db

            function gotData(data) {
                var fruits = data.val();
                // Grab the keys to iterate over the object
                var keys = Object.keys(tests);

                for (var i = 0; i < keys.length; i++) {
                    var key = keys[i];
                    // Look at each fruit object!
                    var test = tests[key];
                }
                console.log("DB change callback- returned object: " + tests);
            }

            //callback for specific id...
            //            var id = '-KVKnwa-MsPXzNbNHdmK';
            //            var ref = database.ref("fruits/" + id);
            //            ref.on("value", gotOne, errData);
            //
            //            function gotOne(data) {
            //                var fruit = data.val();
            //            }
            function errData() {
                console.log('Error on database update callback');
            }
        </script>

    </body>


    <script>

        var intro1 = {
            type: 'instructions',
            pages: [
                'Welcome to the experiment.',
                'Please rate the quality of the following textures using the slider. Click next to begin.'
            ],
            show_clickable_nav: true
        };

        // var intro2 = {
        //    type: 'instructions',
        //   pages: [
        //   'Please rate the COARSENESS or FINENESS of the following textures using the slider',      
        //   ],
        //   show_clickable_nav: true
        // }

        var thanks = {
            type: 'instructions',
            pages: [
                'Thank you for your participation!'
            ],
            show_clickable_nav: true
        };

        // var images = [];// ["textures/1.bmp", "textures/2.bmp", "textures/3.bmp", "textures/4.bmp", "textures/5.bmp", "textures/6.bmp", "textures/7.bmp", "textures/8.bmp", "textures/9.bmp"];

        // for (var i = 1; i <= 9; i++) {
        //     //images.push("textures/2.bmp");
        //   images.push("textures/"+i+".bmp");
        // }

        var slider_tests = {
            type: 'slider-button-response',
            timeline: [
                {
                    labels: ['Low Contrast', 'High Contrast'],
                    prompt: '<p class="center-content">Rate the apparent CONTRAST in this texture</p>',
                    stimulus: 'textures/2.bmp'
                },
                {
                    labels: ['Non-repetitive ', 'Repetitive'],
                    prompt: '<p class="center-content">How REPETITIVE is this texture?</p>',
                    stimulus: 'textures/2.bmp'
                },
                {
                    labels: ['Non-granular ', 'Granular'],
                    prompt: '<p class="center-content">How GRANULAR is this texture?</p>',
                    stimulus: 'textures/2.bmp'
                },
                {
                    labels: ['Non-random', 'Random'],
                    prompt: '<p class="center-content">How RANDOM is this texture?</p>',
                    stimulus: 'textures/2.bmp'
                },
                {
                    labels: ['Rough', 'Smooth'],
                    prompt: '<p class="center-content">How ROUGH or SMOOTH is this texture?</p>',
                    stimulus: 'textures/2.bmp'
                },
                {
                    labels: ['Low feature density', 'High feature density'],
                    prompt: '<p class="center-content">Rate the apparent FEATURE DENSITY in this texture.</p>',
                    stimulus: 'textures/2.bmp'
                },
                {
                    labels: ['Non-directional', 'Directional'],
                    prompt: '<p class="center-content">How DIRECTIONAL is this texture.</p>',
                    stimulus: 'textures/2.bmp'
                },
                {
                    labels: ['Low structural complexity', 'High structural complexity'],
                    prompt: '<p class="center-content">How STRUCTURALLY COMPLEX is this texture?</p>',
                    stimulus: 'textures/2.bmp'
                },
                {
                    labels: ['Coarse', 'Fine'],
                    prompt: '<p class="center-content">How COARSE or FINE is this texture?</p>',
                    stimulus: 'textures/2.bmp'
                },
                {
                    labels: ['Irregular', 'Regular'],
                    prompt: '<p class="center-content">How REGULAR is this texture?</p>',
                    stimulus: 'textures/2.bmp'
                },
                {
                    labels: ['Non-oriented', 'Locally-oriented'],
                    prompt: '<p class="center-content">How LOCALLY-ORIENTED is this texture?</p>',
                    stimulus: 'textures/1.bmp'
                },
                {
                    labels: ['Non-uniform', 'Uniform'],
                    prompt: '<p class="center-content">How UNIFORM is this texture?</p>',
                    stimulus: 'textures/3.bmp'
                }
            ], //end timeline 
            randomize_order: false
        };

        jsPsych.init({
            display_element: $('#jspsych-target'),
            timeline: [intro1, slider_tests, thanks],
            on_finish: function () {
                jsPsych.data.displayData(); //TO DO: remove before publishing
                //var csvString = jsPsych.data.dataAsCSV();
                var dataArray = jsPsych.data.getData();
                tests.push(dataArray, pushFinished); //callback

            }
        });

    </script>

</html>
